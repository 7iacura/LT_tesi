\chapter{Codice Sorgente}
\label{app:codice}

In questa sezione sono riportate e commentate alcune parti del codice sorgente citate nel corso della relazione.

\section*{Templates Django}
\label{app:templates}

Come illustrato nel corso della discussione Django fornisce uno strumento utile per centralizzare e non duplicare codice HTML, i \emph{templates}.

Si é costruito un file \texttt{base.html} (di seguito parte del codice semplificato) per includere in un file unico tutte le informazioni statiche e ripetute in tutti gli altri file HTML del progetto.

\begin{footnotesize}
\begin{verbatim}
 <html>
 <head>
   <title>{% block title %}fem2ambiente {% endblock %}</title>
   <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
 </head>
 <body>
    <nav role="navigation">                        
      {% include "login.html" %}
    </nav>   
   <main>
     {% block content %}{% endblock %}
   </main>

   {% block jsexec %}
     <script src="/static/js/bootstrap.js"></script>
   {% endblock %}
 </body>
 </html>
\end{verbatim}
\end{footnotesize}

Si può notare:
\begin{itemize}
 \item nell'\tag{head} il blocco \tag{title} contiene \dja{block title}, in modo da poter includere nel blocco un titolo diverso per ogni file HTML che viene esteso
 \item \dja{include "login.html"} é la chiamata per includere in quella sezione della barra di navigazione il file dedicato al login, nel quale in base allo stato del cliente (loggato o no) mostrerà il form di login oppure i dati personali
 \item \dja{block content} indica dove andrà inserito il codice HTML del file che estende
 \item \dja{block jsexec} indica la sezione dedicata all'inserimento degli script {\js}
\end{itemize}

Di seguito un esempio di estensione del file \texttt{base.html}.

\begin{footnotesize}
\begin{verbatim}
 {% extends "base.html" %}
 {% block title %}
   {{ block.super }} - Pagina Personale
 {% endblock %}
 {% block content %}
   <div>[...]</div>
 {% endblock %}
 {% block jsexec %}
   {{ block.super }}
   <script type="text/javascript" src="/static/js/fledjed.js"></script>
 {% endblock %}
\end{verbatim}
\end{footnotesize}

Si può notare:
\begin{itemize}
 \item nella prima riga \dja{extends "base.html"} necessario per prendere tutte le informazioni di intestazione eccetera dal file di base
 \item in \dja{block title} (come in \dja{block jsexec} il codice \{\{\texttt{block.super}\}\} che indica come viene ereditato il contenuto del blocco titolo presente nel file di base ed esteso con il contenuto in questo file (analogamente al significato di \texttt{super} in Java). Il titolo risultante sarà \texttt{fem2ambiente - Pagina Personale}.
\end{itemize}


\section*{Traduzione}
\label{app:traduzione}
Django mette a disposizione un sistema per la gestione multilingua della piattaforma, per farlo é necessario inserire piccole parti di codice in tutti i punti che dovranno essere tradotti, sono dette '\emph{translation strings}. Django poi provvederà automaticamente ad incapsulare le stringhe da tradurre e trasferirle in file apposta dove andrà inserita la traduzione; una volta fatto ciò il sistema sarà pronto per supportare il multilingua.

Nel file \texttt{settings.py}:
\begin{footnotesize}
\begin{verbatim}
 LANGUAGES = (
  ('it', gettext('Italian')),
  ('en', gettext('English')),
  ('de', gettext('German')),
  ('fr', gettext('French')),
  ('es', gettext('Spanish')),
 )
\end{verbatim}
\end{footnotesize}

In ogni template HTML é necessario inserire la riga di codice \dja{load i18n} per permettere a Django di individuare le stringe da tradurre, inoltre esse dovranno essere più precisamente indicate. 

Una soluzione é il tag \texttt{trans} utilizzato ad esempio
\begin{footnotesize}
\begin{verbatim}
 {% trans "stringa da tradurre" %}
\end{verbatim}
\end{footnotesize}
oppure (se la stringa da tradurre é utilizzata più volte
\begin{footnotesize}
\begin{verbatim}
 {% trans "stringa da tradurre" as esempio_variabile %}
\end{verbatim}
\end{footnotesize}
e all'interno del testo si andrà ad inserire la variabile collegata.

Un altra soluzione é l'utilizzo del tag \dja{blocktrans}, di seguito un esempio di utilizzo
\begin{footnotesize}
\begin{verbatim}
 {% blocktrans %} 
   stringa da tradurre nella quale si puo inserire un {{esempio_variabile}}
 {% endblocktrans %}
\end{verbatim}
\end{footnotesize}

Procedimento analogo va applicato ai file {\js} che prevedono un output testuale che richiede traduzione, utilizzando la stringa \texttt{gettext()}
\begin{footnotesize}
\begin{verbatim}
 document.write(gettext('stringa da tradurre'));
\end{verbatim}
\end{footnotesize}

Il risultato finale sono file generati da Django con l'estensione \texttt{.po} in cui viene indicata riga, file e path di ogni stringa da tradurre, la stringa inserita nel file originale e lo spazio per inserire la traduzione
\begin{footnotesize}
\begin{verbatim}
 #: path/del/file.py:23
 msgid "Benvenuti nel mio sito."
 msgstr "Welcome to my site."
\end{verbatim}
\end{footnotesize}

Per riesaminare e controllare le stringhe da tradurre a terminale:
\begin{footnotesize}
\begin{verbatim}
 django-admin makemessages -a
\end{verbatim}
\end{footnotesize}
e per compilare
\begin{footnotesize}
\begin{verbatim}
 django-admin compilemessages
\end{verbatim}
\end{footnotesize}

Per i file {\js}, per ogni lingua
\begin{footnotesize}
\begin{verbatim}
 django-admin makemessages -d djangojs -l it
\end{verbatim}
\end{footnotesize}
